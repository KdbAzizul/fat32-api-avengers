# --- USER SERVICE ---
apiVersion: apps/v1
kind: Deployment
metadata: { name: user-service }
spec:
  replicas: 1
  selector: { matchLabels: { app: user-service } }
  template:
    metadata: { labels: { app: user-service } }
    spec:
      containers:
        - name: user-service
          image: shahriar22/demo-user-service:latest
          imagePullPolicy: Always
          ports: [{ containerPort: 8001 }]
          resources: { requests: { memory: "64Mi" }, limits: { memory: "128Mi" } }
          env:
            - { name: DATABASE_URL, value: "postgresql://admin:admin@user-db:5432/user_db" }
            - { name: JAEGER_ENDPOINT, value: "http://jaeger:14268/api/traces" }
---
apiVersion: v1
kind: Service
metadata: { name: user-service }
spec: { ports: [{ port: 8001, targetPort: 8001 }], selector: { app: user-service } }

# --- CAMPAIGN SERVICE ---
---
apiVersion: apps/v1
kind: Deployment
metadata: { name: campaign-service }
spec:
  replicas: 1
  selector: { matchLabels: { app: campaign-service } }
  template:
    metadata: { labels: { app: campaign-service } }
    spec:
      containers:
        - name: campaign-service
          image: shahriar22/demo-campaign-service:latest
          imagePullPolicy: Always
          ports: [{ containerPort: 8002 }]
          resources: { requests: { memory: "64Mi" }, limits: { memory: "128Mi" } }
          env:
            - { name: DATABASE_URL, value: "postgresql://admin:admin@campaign-db:5432/campaign_db" }
            - { name: REDIS_URL, value: "redis://redis:6379/0" }
            - { name: JAEGER_ENDPOINT, value: "http://jaeger:14268/api/traces" }
---
apiVersion: v1
kind: Service
metadata: { name: campaign-service }
spec: { ports: [{ port: 8002, targetPort: 8002 }], selector: { app: campaign-service } }

# --- DONATION SERVICE ---
---
apiVersion: apps/v1
kind: Deployment
metadata: { name: donation-service }
spec:
  replicas: 1
  selector: { matchLabels: { app: donation-service } }
  template:
    metadata: { labels: { app: donation-service } }
    spec:
      containers:
        - name: donation-service
          image: shahriar22/demo-donation-service:latest
          imagePullPolicy: Always
          ports: [{ containerPort: 8003 }]
          resources: { requests: { memory: "64Mi" }, limits: { memory: "128Mi" } }
          env:
            - { name: DATABASE_URL, value: "postgresql://admin:admin@donation-db:5432/donation_db" }
            - { name: REDIS_URL, value: "redis://redis:6379/0" }
            - { name: KAFKA_BOOTSTRAP_SERVERS, value: "kafka:29092" }
            - { name: JAEGER_ENDPOINT, value: "http://jaeger:14268/api/traces" }
---
apiVersion: v1
kind: Service
metadata: { name: donation-service }
spec: { ports: [{ port: 8003, targetPort: 8003 }], selector: { app: donation-service } }

# --- PAYMENT SERVICE ---
---
apiVersion: apps/v1
kind: Deployment
metadata: { name: payment-service }
spec:
  replicas: 1
  selector: { matchLabels: { app: payment-service } }
  template:
    metadata: { labels: { app: payment-service } }
    spec:
      containers:
        - name: payment-service
          image: shahriar22/demo-payment-service:latest
          imagePullPolicy: Always
          ports: [{ containerPort: 8004 }]
          resources: { requests: { memory: "64Mi" }, limits: { memory: "128Mi" } }
          env:
            - { name: DATABASE_URL, value: "postgresql://admin:admin@payment-db:5432/payment_db" }
            - { name: KAFKA_BOOTSTRAP_SERVERS, value: "kafka:29092" }
            - { name: JAEGER_ENDPOINT, value: "http://jaeger:14268/api/traces" }
---
apiVersion: v1
kind: Service
metadata: { name: payment-service }
spec: { ports: [{ port: 8004, targetPort: 8004 }], selector: { app: payment-service } }

# --- NOTIFICATION SERVICE ---
---
apiVersion: apps/v1
kind: Deployment
metadata: { name: notification-service }
spec:
  replicas: 1
  selector: { matchLabels: { app: notification-service } }
  template:
    metadata: { labels: { app: notification-service } }
    spec:
      containers:
        - name: notification-service
          image: shahriar22/demo-notification-service:latest
          imagePullPolicy: Always
          ports: [{ containerPort: 8005 }]
          resources: { requests: { memory: "64Mi" }, limits: { memory: "128Mi" } }
          env:
            - { name: DATABASE_URL, value: "postgresql://admin:admin@notification-db:5432/notification_db" }
            - { name: KAFKA_BOOTSTRAP_SERVERS, value: "kafka:29092" }
            - { name: JAEGER_ENDPOINT, value: "http://jaeger:14268/api/traces" }
---
apiVersion: v1
kind: Service
metadata: { name: notification-service }
spec: { ports: [{ port: 8005, targetPort: 8005 }], selector: { app: notification-service } }

# --- BANKING SERVICE ---
---
apiVersion: apps/v1
kind: Deployment
metadata: { name: banking-service }
spec:
  replicas: 1
  selector: { matchLabels: { app: banking-service } }
  template:
    metadata: { labels: { app: banking-service } }
    spec:
      containers:
        - name: banking-service
          image: shahriar22/demo-banking-service:latest
          imagePullPolicy: Always
          ports: [{ containerPort: 8006 }]
          resources: { requests: { memory: "64Mi" }, limits: { memory: "128Mi" } }
          env:
            - { name: DATABASE_URL, value: "postgresql+asyncpg://admin:admin@banking-db:5432/banking_db" }
            - { name: JAEGER_ENDPOINT, value: "http://jaeger:14268/api/traces" }
---
apiVersion: v1
kind: Service
metadata: { name: banking-service }
spec: { ports: [{ port: 8006, targetPort: 8006 }], selector: { app: banking-service } }